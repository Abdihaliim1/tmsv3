<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Data</title>
</head>

<body>
    <h1>Debug Data Output</h1>
    <div id="output"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="main.js"></script>

    <script>
        const output = document.getElementById('output');
        function log(msg) {
            const div = document.createElement('div');
            div.textContent = msg;
            output.appendChild(div);
            console.log(msg);
        }

        function logObj(label, obj) {
            const div = document.createElement('div');
            div.textContent = label + ': ' + JSON.stringify(obj, null, 2);
            div.style.whiteSpace = 'pre-wrap';
            output.appendChild(div);
            console.log(label, obj);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for DataManager to initialize
            setTimeout(async () => {
                if (typeof DataManager === 'undefined') {
                    log('DataManager not loaded');
                    return;
                }

                // We need to wait for data to load. 
                // Since we can't easily hook into "loaded" event without modifying main.js,
                // we'll just wait a bit more or check if data is there.

                log('Checking DataManager data...');

                const drivers = DataManager.drivers || [];
                const loads = DataManager.loads || [];

                log(`Total Drivers: ${drivers.length}`);
                log(`Total Loads: ${loads.length}`);

                const ownerOperators = drivers.filter(d => d.driverType === 'owner_operator');
                log(`Owner Operators: ${ownerOperators.length}`);

                ownerOperators.forEach(d => {
                    logObj(`Owner Operator [${d.id}] (${d.firstName} ${d.lastName})`, {
                        driverType: d.driverType,
                        paymentType: d.payment?.type,
                        payPercentage: d.payPercentage,
                        paymentObj: d.payment
                    });
                });

                const loadsWithOO = loads.filter(l => {
                    if (!l.driverId) return false;
                    const driver = drivers.find(d => d.id === l.driverId);
                    return driver && driver.driverType === 'owner_operator';
                });

                log(`Loads assigned to Owner Operators: ${loadsWithOO.length}`);

                loadsWithOO.forEach(l => {
                    logObj(`Load [${l.id}]`, {
                        driverId: l.driverId,
                        rate: l.rate,
                        status: l.status
                    });
                });

            }, 3000); // Wait 3 seconds for Firebase to load
        });
    </script>
</body>

</html>